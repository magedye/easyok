# ๐๏ธ ูุซููุฉ ุงูุชุตููู (Project Design / Architecture Document)

ุชูุฏู ูุฐู ุงููุซููุฉ ูุธุฑุฉ ุดุงููุฉ ุนูู ุงูุชุตููู ุงููุนูุงุฑู ููุธุงู EasyDataุ ุจูุง ูู ุฐูู ููููุงุช ุงููุธุงูุ ุงูุนูุงูุงุช ุจูููุงุ ูุงููุฑุงุฑุงุช ุงูุชุตููููุฉ ุงูุฑุฆูุณูุฉ. ุชูุฏู ุงููุซููุฉ ุฅูู ุชูุฌูู ุงููุทูุฑูู ุนูุฏ ุจูุงุก ุงููุธุงู ูุถูุงู ุงูุงุชุณุงู ูุงูุชูุงุบู ุจูู ุงูุฃุฌุฒุงุก ุงููุฎุชููุฉ.

## 1. ุงูุฑุคูุฉ ุงููุนูุงุฑูุฉ ุงูุนุงูุฉ

ูุนุชูุฏ EasyData ุนูู ูููู Monolith ููุธูู ูุน ุทุจูุงุช ูุงุถุญุฉุ ุญูุซ ูููุณู ุฅูู ุซูุงุซุฉ ุฃูุณุงู ุฑุฆูุณูุฉ:

1. **ุทุจูุฉ ุงููุงุฌูุฉ (Frontend):** ูููู ูุงุฌูุฉ (`<vanna-chat>`) ููุธุงู ููุญุฉ ุงูููุงุฏุฉ ูุจุซ ุงููุชุงุฆุฌ. ุชุชุญุฏุซ ูุน ุงููุงุฌูุฉ ุงูุฎูููุฉ ุนุจุฑ REST ูSSE.
2. **ุทุจูุฉ ุงูุฎุงุฏู (Backend):** ุชุทุจูู FastAPI ูููุฐ ุงูููุทู ุงูุชุฌุงุฑูุ ููุชู ุจุงููุตุงุฏูุฉ ูุงูุฃุฐููุงุชุ ููููู ุจุชูุฌูู ุงูุทูุจุงุช ุฅูู ุงูุฎุฏูุงุช ุงูุฏุงุฎููุฉ.
3. **ุทุจูุฉ ูููู ุงููุณุชุฎุฏู (UserโAware Agent):** ุชุดุชูู ุนูู ุฎุฏูุฉ Vanna ุงูุชู ุชููุฐ RAG ูุงูุชูููุฏ ูุงูุชูููุฐุ ูุฎุฏูุงุช ุงูุชุฏุฑูุจ ูุงูููุงุญุธุงุช.

## 2. ุจููุฉ ุงููููุงุช ูุงููุฌูุฏุงุช

ุชู ุชูุถูุฌ ุงููููู ุงููุงูู ูููุฌูุฏุงุช ูู ูุซููุฉ ุงูุชูุฌููุงุช. ูู ูุฌูุฏ ูู ูุณุคูููุฉ ูุญุฏุฏุฉ:

- `core/`: ุฅุนุฏุงุฏุงุช ูุซูุงุจุช ูุงุณุชุซูุงุกุงุช.
- `models/`: ูุฎุทุทุงุช Pydantic ูููุงุฐุฌ SQLAlchemy.
- `providers/`: ูููุฑู ููุงุนุฏ ุงูุจูุงูุงุช ููุฎุงุฒู ุงููุชุฌูุงุช ูุงูููุงุฐุฌ.
- `services/`: ููุทู ุงูุฃุนูุงู (Vanna, Orchestration, Training, Feedback).
- `api/`: ููุงุท ุงูููุงูุฉ ูุชุจุนูุงุชูุง.
- `middleware/`: ุทุจูุงุช ููุทุนูุฉ (Logging, Rate Limiting, Performance).
- `utils/`: ุฃุฏูุงุช ูุณุงุนุฏุฉ (SQL Guard, Path Helper).

## 3. ุณูุฑ ุงูุนูู (Workflow)

### 3.1 ูุฑุญูุฉ ุงูุงุณุชูุจุงู ูุงูุชุญูู

1. ูุณุชูุจู ุงูุฎุงุฏู ุทูุจูุง ูู ุงููุณุชุฎุฏู ุนุจุฑ ุงูููุทุฉ `/api/v1/ask`.
2. ูุชู ุงูุชุญูู ูู ุฑูุฒ JWT ูุงุณุชุฎุฑุงุฌ ูุนุฑู ุงููุณุชุฎุฏู ูุฏูุฑู ููุทุงูุงุชู (RLS).
3. ูููุดุฆ ุงูููุฌููู ูุงุฆู Orchestration Service ูููุฑุฑ ุงูุณุคุงู ูุจูุงูุงุช ุงููุณุชุฎุฏู.

### 3.2 ูุฑุญูุฉ ุงูุฐุงูุฑุฉ ุงููุนุฒุฒุฉ (RAG)

1. ูุจุญุซ Vanna Service ูู ูุฎุฒู ุงููุชุฌูุงุช ุนู ุฃุณุฆูุฉ ูุดุงุจูุฉ ุจุงุณุชุฏุนุงุก `vector_store.query()`.
2. ุฅุฐุง ููุฌูุฏ ุงุณุชุนูุงู ูุดุงุจู ุจุฏุฑุฌุฉ ุนุงููุฉุ ูุชู ุฅุนุงุฏุฉ ุงุณุชุฎุฏุงู SQL ุงูููุฌูุฏ ูุน ุชุนุฏูู ุณูุงู ุงูุชุงุฑูุฎ ุฃู ุงูุนูุงุตุฑ ุงูุฎุงุตุฉ.
3. ุฅุฐุง ูู ูููุฌุฏ ุชุดุงุจู ูุงููุ ุชูุจูู ูุทุงูุจุฉ (Prompt) ุฌุฏูุฏุฉ ุชุญุชูู ุนูู ุงูุณุคุงู ูุงููููุฏุ ุซู ูุณุชุฏุนู LLM ุนุจุฑ `llm.generate_sql()` ูุชูููุฏ SQL ุฌุฏูุฏ.

### 3.3 ูุฑุญูุฉ ุชูููุฐ SQL

1. ูุชู ูุญุต SQL ุนุจุฑ `sql_guard.validate_and_normalise()`. ูุฑูุถ ุฃู ุนูููุงุช ุชุนุฏูู ุจูุงูุงุช.
2. ูุชู ุญูู ูููุฏ RLS ูู ุงูุงุณุชุนูุงูุ ุจุญูุซ ูุญุตู ูู ูุณุชุฎุฏู ุนูู ุงูุตููู ุงูุฎุงุตุฉ ุจู ููุท.
3. ููููููุฐ ุงูุงุณุชุนูุงู ุนุจุฑ ุงููููุฑ ุงูููุงุณุจ (`OracleProvider` ุฃู `MSSQLProvider`) ูุน ุถูุงู ุงุชุตุงู READโONLY.
4. ูุชู ุฌูุน ุงููุชุงุฆุฌ ูุชุญููููุง ุฅูู ูุงุฆูุฉ ูู ุงูููุงููุณ.

### 3.4 ูุฑุญูุฉ ุงูุจุซ ูุงูุชูุฎูุต

1. ุชูุฑุณู ุงููุฑุญูุฉ ุงูุฃููู ูู ุงูุงุณุชุฌุงุจุฉ ูููุงุฌูุฉ ุงูุฃูุงููุฉุ ูุชุถููุฉ 100 ุตู ูุญุฏ ุฃูุตู.
2. ููููุฏ ุชูููู ุงูุฑุณู ุงูุจูุงูู ุชููุงุฆูุงู ุจูุงุกู ุนูู ููุน ุงูุจูุงูุงุช (ุดุฑูุท/ุฎุท/ุฏุงุฆุฑุฉ) ูููุจุซ ูู ุงููุฑุญูุฉ ุงูุซุงููุฉ.
3. ููุณุชุฏุนู ุงููููุฐุฌ ูุชูููุฏ ููุฎุต ูุบูู ุจุณูุท ูููุชุงุฆุฌุ ูููุฑุณู ูู ุงููุฑุญูุฉ ุงูุซุงูุซุฉ.
4. ุชูุณุฌู ุงูุนูููุฉ ุจุฑูุชูุง ูู ุฌุฏูู `audit_logs` ูุน ุฌููุน ุงููุนูููุงุช ุงููุงุฒูุฉ ููุชุฏููู.

### 3.5 ุฏูุฑุฉ ุงูุชุนูู ุงูุฐุงุชู

ุจุนุฏ ูุฌุงุญ ุงูุงุณุชุนูุงูุ ููู ุญุงู ูุงู ุฌุฏูุฏุงูุ ูุชู ุชุฎุฒูู ุงูุณุคุงู ูSQL ุงููุงุชุฌ ูู ูุฎุฒู ุงููุชุฌูุงุช ููู ุฌุฏูู `training_data` ุจุนุฏ ุงูููุงููุฉ. ูุชููู ุงููุณุชุฎุฏููู ุฏูุฑุงุช ุชุฏุฑูุจูุฉ ูุณุชูุจููุฉ ูุชุงุฆุฌ ุฃูุซุฑ ุฏูุฉ ูุฃุณุฆูุฉ ูุดุงุจูุฉ.

## 4. ุฎุฏูุงุช ุฑุฆูุณูุฉ

### 4.1 VannaService

- ูุณุชุฏุนู ูููุฑ ุงููุฎุฒู ุงููุชุฌูุงุช ููุฒููุฏ LLM.
- ูุญุชูู ุนูู Circuit Breaker ูุญูุงูุฉ ุงูุฎุฏูุงุช ุงูุฎุงุฑุฌูุฉ ูู ุงููุดู ุงููุชูุฑุฑ.
- ูููุฐ ููุทู ุงูุจุซ ุจุซูุงุซ ูุฑุงุญู.

### 4.2 OrchestrationService

- ููุณู ุจูู ุงููุณุชุฎุฏู ูุฎุฏูุฉ Vanna ูุฎุฏูุงุช ุงูุชุฏุฑูุจ.
- ูุทุจู ุขููุฉ ุงููุญุงููุฉ ุงููุชูุฑุฑุฉ (Retry) ุนูุฏ ูุดู ุงูุงุณุชุนูุงู.
- ูุญูู RLS ุจูุงุกู ุนูู ูุทุงูุงุช ุงููุณุชุฎุฏู.

### 4.3 TrainingService & FeedbackService

- ุชุฏูุฑ ุฅุถุงูุฉ ุฃู ุญุฐู ุจูุงูุงุช ุงูุชุฏุฑูุจ.
- ุชุณุฌูู ุงูููุงุญุธุงุช ูุชุญุฏูุซ ูุณุชูู ูุฏุฑุงุช ุงููุณุชุฎุฏููู.

## 5. ุงูุชุตููู ุงูุฃููู

ูุนุชูุฏ ุงูุฃูุงู ุนูู ุทุจูุงุช ูุชุนุฏุฏุฉ:

1. **JWT** ููุชุญูู ูู ุงููููุฉ ูุงูุฏูุฑ.
2. **RBAC** ูุชุญุฏูุฏ ุตูุงุญูุงุช ูู ุฏูุฑ ููุง ูู ูุซููุฉ ูุตูููุฉ ุงูุฃูุงู.
3. **SQL Firewall** ูููุน ุฃู ุฌููุฉ ุชุนุฏูู ุจูุงูุงุช ุฃู ุฌููุฉ ุฎุทูุฑุฉ.
4. **RLS** ูุถูุงู ุนุฏู ุชุฌุงูุฒ ูุทุงูุงุช ุงูุจูุงูุงุช ุงููุณููุญ ุจูุง.
5. **Circuit Breaker** ูุญูุงูุฉ ุงููุธุงู ูู ูุดู ุงูุฎุฏูุงุช ุงูุฎุงุฑุฌูุฉ.

## 6. ุงูุงุนุชุจุงุฑุงุช ุงููุณุชูุจููุฉ

- **ูุงุจููุฉ ุงูุชูุณูุน:** ูููู ููู ุงููุดุฑูุน ุฅูู ุจููุฉ Modular Monolith ุฃู ุญุชู Microservices ูุงุญูุงู ุฏูู ุฅุนุงุฏุฉ ูุชุงุจุฉ ุงูุฌููุฑุ ุจูุถู ุงูุนููุฏ ุงููุงุถุญุฉ.
- **ุงูุชูุงูู ูุน ูุงุฌูุงุช ุฃุฎุฑู:** ุชุตููู ุงูููุงุท ุงูููุงุฆูุฉ ูุณูุญ ุจุฅุถุงูุฉ ูููุงุช ูุซู Teams ูSlack ุนุจุฑ ุชููููุงุช ุฌุฏูุฏุฉ ุฏูู ุชุนุฏูู ุฌููุฑู.
- **ุชุจุฏูู ูููุฑู ุงูู LLM ุฃู ูุฎุฒู ุงููุชุฌูุงุช:** ูุชู ุงูุงุฎุชูุงุฑ ุนุจุฑ ููู `.env` ูุชุชุญูู ุจู Factoriesุ ููุง ูุณูู ุงูุชุจุฏูู.

## 7. ุงูุฎูุงุตุฉ

ุชู ุชุตููู EasyData ูุชุญููู ุงูุชูุงุฒู ุจูู ุงููุฑููุฉ ูุงูุฃูุงู ูุงูุฃุฏุงุก. ุงููููู ุงูุทุจูู ุงููุงุถุญ ูุณููู ุตูุงูุฉ ุงููุธุงู ูุชุญุณููู. ูุน ุงุนุชูุงุฏ ูููุฌ RAG ุงููุฏุนูู ุจุฐุงูุฑุฉ ุฃุฏูุงุชุ ูููู ูููุธุงู ุงูุชุนูู ูุงูุชุญุณู ูุน ูุฑูุฑ ุงูููุชุ ุจูููุง ุชุญููู ุทุจูุงุช ุงูุฃูุงู ูู ุฅุณุงุกุฉ ุงูุงุณุชุฎุฏุงู. ูุฌุจ ุชุญุฏูุซ ูุฐู ุงููุซููุฉ ูููุง ุชู ุชุนุฏูู ุฌุฒุก ููู ูู ุงูุชุตููู.