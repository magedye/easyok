# ๐ ูุซููุฉ ูููุฐุฌ ุงูุจูุงูุงุช ูุณูุงู ุงูุนูู (Data Model & Schema Context)

ุชุญุชูู ูุฐู ุงููุซููุฉ ุนูู ูุตู ูููุงุฐุฌ ุงูุจูุงูุงุช ุงููุณุชุฎุฏูุฉ ูู ุงููุธุงูุ ุจุงูุฅุถุงูุฉ ุฅูู ุงูุณูุงู ุงูุฐู ุชูุณุชุฎุฏู ููู ุฏุงุฎู ุนูููุงุช ุงูุฐุงูุฑุฉ ุงููุนุฒุฒุฉ (RAG) ูุงูุชุฏุฑูุจ ูุงูุฃูุงู.

## 1. ููุฏูุฉ

ูุนุชูุฏ ุงููุธุงู ุนูู ูุฌููุนุชูู ูู ููุงุนุฏ ุงูุจูุงูุงุช:

1. **ูุงุนุฏุฉ ุจูุงูุงุช ุงููุณุชุฎุฏู** (User DB) ุงูุชู ุชุญุชูู ุนูู ุงูุจูุงูุงุช ุงูุชุดุบูููุฉ (ูุซู ูุนุงููุงุช ุงููุจูุนุงุช). ูุชู ุงูุงุชุตุงู ุจูุง ุจุดูู READโONLY ุนุจุฑ ูููุฑู Oracle ุฃู MSSQL.
2. **ูุงุนุฏุฉ ุจูุงูุงุช ุงููุธุงู** (System DB) ุงูุชู ุชูุณุชุฎุฏู ูุชุณุฌูู ุงูุณุฌูุงุช (Audit) ูุชุฎุฒูู ุจูุงูุงุช ุงูุชุฏุฑูุจ ูุงูููุงุญุธุงุช. ูููู ุฃู ุชููู SQLite ููุชุดุบูู ุงููุญูู ุฃู PostgreSQL ูุฅูุชุงุฌ ูุณุชูุฑ.

## 2. ุงูููุงุฐุฌ ุงูุฃุณุงุณูุฉ ูู ูุงุนุฏุฉ ุจูุงูุงุช ุงููุธุงู

### 2.1 ุฌุฏูู `audit_logs`

ููุซู ูู ุงุณุชุนูุงู ุชู ุฅูุดุงุคู ูุชูููุฐูุ ููุชุถูู ุงููุนูููุงุช ุงูุชุงููุฉ:

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|------|------|
| `id` | ุนุฏุฏ ุตุญูุญ (ููุชุงุญ ุฃุณุงุณู) | ูุนุฑู ุงูุณุฌู |
| `user_id` | ูุต | ูุนุฑู ุงููุณุชุฎุฏู ุงูุฐู ุฃุทูู ุงูุงุณุชุนูุงู |
| `question` | ูุต ุทููู | ูุต ุงูุณุคุงู ุงูุทุจูุนู |
| `sql` | ูุต ุทููู | SQL ุงูุฐู ุชู ุชูููุฐู |
| `status` | ูุต ูุตูุฑ | ุญุงูุฉ ุงูุชูููุฐ: `success`, `failed`, `timeout` |
| `error_message` | ูุต ุทููู | ุฑุณุงูุฉ ุงูุฎุทุฃ ูู ุญุงู ุงููุดู |
| `execution_time_ms` | ุนุฏุฏ ุตุญูุญ | ุฒูู ุชูููุฐ ุงูุงุณุชุนูุงู ุจุงููููู ุซุงููุฉ |
| `row_count` | ุนุฏุฏ ุตุญูุญ | ุนุฏุฏ ุงูุตููู ุงููุนุงุฏุฉ |
| `timestamp` | ุชุงุฑูุฎ/ููุช | ููุช ุฅูุดุงุก ุงูุณุฌู |
| `correlation_id` | ูุต | ูุนุฑูู ูุฑูุฏ ููุชุจุน ุจูู ุงูุฎุฏูุงุช |

### 2.2 ุฌุฏูู `training_data`

ูุญุชูู ุนูู ุฃุฒูุงุฌ ุณุคุงูโSQL ูุตุงุฏู ุนูููุง ููุชู ุงุณุชุฎุฏุงููุง ูู RAG:

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|------|------|
| `id` | ุนุฏุฏ ุตุญูุญ | ูุนุฑู ุงูุนูุตุฑ |
| `question` | ูุต ุทููู | ุงูุณุคุงู ุงููุนุชูุฏ |
| `sql` | ูุต ุทููู | ุงูุงุณุชุนูุงู ุงูููุงูู ุนููู |
| `is_approved` | ููุทููุฉ | ูู ุชูุช ุงูููุงููุฉ ุนูููุ |
| `approved_by` | ูุต | ูุนุฑู ุงููุณุชุฎุฏู ุงูุฐู ูุงูู |
| `approved_at` | ุชุงุฑูุฎ/ููุช | ููุช ุงูููุงููุฉ |
| `uploaded_by` | ูุต | ูุนุฑู ูู ุฑูุน ุงูุนูุตุฑ |
| `uploaded_at` | ุชุงุฑูุฎ/ููุช | ููุช ุงูุฑูุน |
| `usage_count` | ุนุฏุฏ ุตุญูุญ | ูู ูุฑุฉ ุชู ุงุณุชุฎุฏุงู ูุฐุง ุงูุนูุตุฑ |
| `validation_score` | ุนุฏุฏ ุนุดุฑู | ุฏุฑุฌุฉ ุงูุตุญุฉ (0 ุฅูู 1) ุจูุงุกู ุนูู ุงูููุงุญุธุงุช |

### 2.3 ุฌุฏูู `user_feedback`

ูุญูุธ ููุงุญุธุงุช ุงููุณุชุฎุฏููู ุจุนุฏ ูุดุงูุฏุฉ ุงููุชุงุฆุฌ:

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|------|------|
| `id` | ุนุฏุฏ ุตุญูุญ | ูุนุฑู ุงูููุงุญุธุฉ |
| `audit_log_id` | ุนุฏุฏ ุตุญูุญ | ุฑุงุจุท ุฅูู ุณุฌู ุงูุชุฏููู |
| `user_id` | ูุต | ูุนุฑู ุงููุณุชุฎุฏู ุงูุฐู ุฃุนุทู ุงูููุงุญุธุฉ |
| `is_valid` | ููุทููุฉ | ูู ุงุนุชุจุฑ ุงููุชูุฌุฉ ุตุญูุญุฉุ |
| `comment` | ูุต ุทููู | ุชุนููู ุฅุถุงูู |
| `created_at` | ุชุงุฑูุฎ/ููุช | ููุช ุฅูุดุงุก ุงูููุงุญุธุฉ |

### 2.4 ุฌุฏูู `user_capability`

ูุชุชุจุน ูุณุชูู ูุฏุฑุงุช ูู ูุณุชุฎุฏู ูุนุฏุฏ ุงูุงุณุชุนูุงูุงุช ุงูุตุญูุญุฉ/ุงููุงุดูุฉ:

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|------|------|
| `user_id` | ูุต (ููุชุงุญ ุฑุฆูุณู) | ูุนุฑู ุงููุณุชุฎุฏู |
| `capability_level` | ุนุฏุฏ ุตุญูุญ | ูุณุชูู ุงููุฏุฑุงุช (1โ5) |
| `validated_queries` | ุนุฏุฏ ุตุญูุญ | ุนุฏุฏ ุงูุงุณุชุนูุงูุงุช ุงูุตุญูุญุฉ |
| `failed_queries` | ุนุฏุฏ ุตุญูุญ | ุนุฏุฏ ุงูุงุณุชุนูุงูุงุช ุงููุงุดูุฉ |
| `success_rate` | ุนุฏุฏ ุนุดุฑู | ูุนุฏู ุงููุฌุงุญ |
| `last_updated` | ุชุงุฑูุฎ/ููุช | ุขุฎุฑ ุชุญุฏูุซ |

### 2.5 ุฌุฏูู `user_data_scopes`

ูุญุฏุฏ ูุทุงูุงุช ุงููุตูู ุนูู ูุณุชูู ุงูุตููู (RLS) ููู ูุณุชุฎุฏู:

| ุงูุญูู | ุงูููุน | ุงููุตู |
|-------|------|------|
| `id` | ุนุฏุฏ ุตุญูุญ | ูุนุฑู |
| `user_id` | ูุต | ูุนุฑู ุงููุณุชุฎุฏู |
| `column_name` | ูุต | ุงุณู ุงูุนููุฏ ุงูุฐู ูุชู ุชุทุจูู ุงูุชุตููุฉ ุนููู |
| `allowed_values` | ูุต ุทููู | ูุงุฆูุฉ ุงูููู ุงููุณููุญ ุจูุง (JSON ูุฎุฒูู ููุต) |

## 3. ุงูุณูุงู ุฏุงุฎู ุงูุฐุงูุฑุฉ ุงููุนุฒุฒุฉ (RAG)

- **ูุฎุฒู ุงููุชุฌูุงุช (Vector Store):** ูุชู ุชุฎุฒูู ุฃุฒูุงุฌ ุงูุณุคุงูโSQL ุงููุนุชูุฏุฉ ูู ูุฎุฒู ูุชุฌูุงุช ูุซู Chroma ุฃู Qdrant. ุนูุฏ ูุตูู ุณุคุงู ุฌุฏูุฏุ ูุชู ุงูุจุญุซ ุนู ุงูุฃุณุฆูุฉ ุงููุดุงุจูุฉ ูุงุณุชุฑุฌุงุน ุงุณุชุนูุงูุงุชูู.
- **ุฐุงูุฑุฉ ุงูุฃุฏูุงุช (Tool Memory):** ุชุชุถูู ุฃูุถูุง ุชูุซูููุง ูDDL ู metadata ุฃุฎุฑู ูุชุญุณูู ูุฏุฑุฉ ุงููููุฐุฌ ุนูู ุงูููู.
- **ุงูุชุฏุฑูุจ ุงูุฐุงุชู:** ุนูุฏ ูุฌุงุญ ุงุณุชุนูุงู ุฌุฏูุฏ ูุงุดุฆ ูู ุณุคุงู ุฌุฏูุฏุ ูุชู ุญูุธู ูู ุฌุฏุงูู `training_data` ู`audit_logs` ูุน ูุงูุฉ ุงูุชูุงุตูู.

## 4. ุงูุนูุงูุงุช ุจูู ุงูููุงุฐุฌ

```
audit_logs 1---* user_feedback
training_data 1---* audit_logs  (ุบูุฑ ูุจุงุดุฑุฉ ุนุจุฑ RAG)
user_capability 1---1 users (ุบูุฑ ูุนุฑู ููุง)
user_data_scopes 1---* users (ุบูุฑ ูุนุฑู ููุง)
```

## 5. ุฎูุงุตุฉ

ูุฐู ุงูููุงุฐุฌ ุชูุซู ุงูุฃุณุงุณ ุงูุฐู ุณูุชู ุงูุจูุงุก ุนููู ูุฅุชูุงู ุนูููุฉ ุงูุชุชุจุน ูุงูุชุฏุฑูุจ ูุงูุฃูุงู. ููุจุบู ุชุญุฏูุซ ูุซููุฉ ุงููุฎุทุท ูุฐู ูู ุญุงู ุฅุถุงูุฉ ุฌุฏุงูู ุฌุฏูุฏุฉ ุฃู ุชุนุฏูู ูู ุชุตููู ูุงุนุฏุฉ ุงูุจูุงูุงุช.